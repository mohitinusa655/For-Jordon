<script>
const herName = "Jordon"; // ðŸ’– CHANGE NAME HERE

const song = document.getElementById("song");
const yesBtn = document.getElementById("yes");
const noBtn = document.getElementById("no");
const lyricsDiv = document.getElementById("lyrics");
const proposal = document.getElementById("proposal");
const nameDiv = document.getElementById("name");
const ring = document.getElementById("ring");

nameDiv.textContent = herName;

// 1. TUNED TIMING: "Perfect" vocals start around 18.8s
// If the lyrics appear too early, DECREASE this number.
// If they appear too late, INCREASE this number.
const vocalOffset = 18.5; 

// 2. UPDATED DATA: 
// I adjusted the 'time' to match the actual song rhythm better.
const karaoke = [
  { time: 0, words: ["I", "found", "a", "loveâ€¦"] },
  { time: 3.8, words: ["For", "meâ€¦"] },
  { time: 7.5, words: ["Darling,", "just", "dive", "right", "inâ€¦"] },
  { time: 11.5, words: ["And", "follow", "my", "leadâ€¦"] },
  { time: 15.5, words: ["Well", "I", "found", "a", "girl...", "beautiful", "and", "sweet"] } // Added extra line for transition
];

let currentLine = -1;
let wordTimer;

// No button escape
noBtn.addEventListener("mouseover", () => {
  noBtn.style.left = Math.random() * (window.innerWidth - 100) + "px";
  noBtn.style.top = Math.random() * (window.innerHeight - 50) + "px";
});

yesBtn.onclick = () => {
  song.currentTime = vocalOffset;
  song.volume = 1;
  song.play();
  startHearts();

  // Show proposal after the lyrics are done (approx 20s)
  setTimeout(() => {
    fadeOutSong();
    showProposal();
  }, 20000); 
};

// Karaoke sync logic
song.addEventListener("timeupdate", () => {
  // Get current time relative to when vocals start
  const t = song.currentTime - vocalOffset;
  
  for (let i = 0; i < karaoke.length; i++) {
    // Check if we hit the time for this line AND haven't shown it yet
    if (t >= karaoke[i].time && currentLine !== i) {
      currentLine = i;
      
      // Calculate how long this line should take based on the NEXT line's start time
      let duration = 3000; // Default 3 seconds if it's the last line
      if (i < karaoke.length - 1) {
        duration = (karaoke[i + 1].time - karaoke[i].time) * 1000;
      }
      
      showLine(karaoke[i], duration);
      break;
    }
  }
});

function showLine(line, duration) {
  clearInterval(wordTimer);
  
  lyricsDiv.innerHTML = line.words
    .map(w => `<span class="word">${w}</span>`)
    .join(" ");

  const words = document.querySelectorAll(".word");
  let index = 0;

  // KEY FIX: Calculate speed based on how much time we have vs. how many words
  // We subtract 200ms to ensure the words finish just before the next line starts
  const speed = (duration - 200) / words.length;

  wordTimer = setInterval(() => {
    if (index < words.length) {
      words[index].classList.add("active");
      index++;
    } else {
      clearInterval(wordTimer);
    }
  }, speed);
}

function fadeOutSong() {
  const fade = setInterval(() => {
    if (song.volume > 0.05) song.volume -= 0.05;
    else { song.pause(); clearInterval(fade); }
  }, 200);
}

function showProposal() {
  document.getElementById("question").style.display = "none";
  yesBtn.style.display = "none";
  noBtn.style.display = "none";
  lyricsDiv.style.display = "none";
  proposal.style.display = "block";
}

ring.onclick = () => {
  startFireworks();
  document.getElementById("finalMsg").textContent =
    "You are my today, my tomorrow, my forever â¤ï¸";
};

function startHearts() {
  setInterval(() => {
    const el = document.createElement("div");
    el.className = "float";
    el.textContent = Math.random() > 0.5 ? "â¤ï¸" : "ðŸŒ¹";
    el.style.left = Math.random() * 100 + "vw";
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 6000);
  }, 300);
}

function startFireworks() {
  setInterval(() => {
    const fw = document.createElement("div");
    fw.className = "firework";
    fw.textContent = "ðŸŽ†";
    fw.style.left = Math.random() * 100 + "vw";
    fw.style.top = Math.random() * 60 + "vh";
    document.body.appendChild(fw);
    setTimeout(() => fw.remove(), 2500);
  }, 400);
}
</script>
